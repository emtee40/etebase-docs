"use strict";(self.webpackChunketebase_docs=self.webpackChunketebase_docs||[]).push([[886],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return h}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),h=i,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||r;return t?a.createElement(m,o(o({ref:n},c),{},{components:t})):a.createElement(m,o({ref:n},c))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7262:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var a=t(7462),i=t(3366),r=(t(7294),t(3905)),o=["components"],s={title:"Authentication"},l=void 0,p={unversionedId:"protocol-specs/authentication",id:"protocol-specs/authentication",title:"Authentication",description:"Etebase uses a challenge-response zero-knowledge proof for authentication. The client asks the server for an authentication challenge using the authentication/loginchallenge/ HTTP endpoint, and then responds with a signed message to prove it posses the authentication private key.",source:"@site/docs/protocol-specs/authentication.md",sourceDirName:"protocol-specs",slug:"/protocol-specs/authentication",permalink:"/protocol-specs/authentication",editUrl:"https://github.com/etesync/etebase-docs/edit/master/docs/protocol-specs/authentication.md",tags:[],version:"current",frontMatter:{title:"Authentication"},sidebar:"someSidebar",previous:{title:"Introduction",permalink:"/protocol-specs/introduction"},next:{title:"Fetching Data",permalink:"/protocol-specs/fetching-data"}},c={},u=[{value:"Signup",id:"signup",level:2},{value:"Login",id:"login",level:2},{value:"Password Change",id:"password-change",level:2}],d={toc:u};function h(e){var n=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Etebase uses a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Challenge%E2%80%93response_authentication"},"challenge-response")," zero-knowledge proof for authentication. The client asks the server for an authentication challenge using the ",(0,r.kt)("inlineCode",{parentName:"p"},"authentication/login_challenge/")," HTTP endpoint, and then responds with a signed message to prove it posses the authentication private key."),(0,r.kt)("p",null,"This makes it possible for Etebase clients to authenticate in a secure manner without needing to send the server any secret information. This ensures that even if the connection was eavesdropped, or the server compromised, an attacker wouldn't be able to impersonate the user, login as them, or gain access to any secret information."),(0,r.kt)("h2",{id:"signup"},"Signup"),(0,r.kt)("p",null,"In order to use an Etebase server clients first need to signup (create an account). To do this, they first securely generate their cryptographic material and then upload the non-secret parts of it to the server."),(0,r.kt)("p",null,"The clients need to generate the following data:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"salt"),": securely generated random bytes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mainKey"),": the user's main encryption key ",(0,r.kt)("a",{parentName:"li",href:"/protocol-specs/introduction#key-derivation"},"derived")," using the ",(0,r.kt)("inlineCode",{parentName:"li"},"salt"),", and the user password."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"accountKey"),": a randomly generated symmetric encryption key."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"authenticationKeypair"),": a deterministically generated keypair derived from a key that's in turn derived from ",(0,r.kt)("inlineCode",{parentName:"li"},"mainKey"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identityKeypair"),": a randomly generated keypair that's used for establishing trust between Etebase users.")),(0,r.kt)("p",null,"It then encrypts ",(0,r.kt)("inlineCode",{parentName:"p"},"identityKeypair")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"accountKey")," using ",(0,r.kt)("inlineCode",{parentName:"p"},"mainKey")," into ",(0,r.kt)("inlineCode",{parentName:"p"},"encryptedContent"),"."),(0,r.kt)("p",null,"It then uploads the ",(0,r.kt)("inlineCode",{parentName:"p"},"SigupBody")," to the server using the ",(0,r.kt)("inlineCode",{parentName:"p"},"authentication/signup/")," HTTP endpoint as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"User {\n  username: str,\n  email: str,\n}\n\nsalt = randombytes(32)\nmainKey = pwhash(password, salt)\naccountKey = randombytes(32)\nencryptedContent = encrypt(mainKey, concat(accountKey, identityKeypair.privkey))\nloginPubkey = aunthenticationKeypair.pubkey\npubkey = identityKeypair.pubkey\n\nSignupBody {\n    user: User,\n    salt: [u8],\n    loginPubkey: [u8],\n    pubkey: [u8],\n    encryptedContent: [u8],\n}\n")),(0,r.kt)("h2",{id:"login"},"Login"),(0,r.kt)("p",null,"In order to login to Etebase, a client first asks the server for the login challenge using the ",(0,r.kt)("inlineCode",{parentName:"p"},"authentication/login_challenge/")," endpoint. The response contains ",(0,r.kt)("inlineCode",{parentName:"p"},"salt")," and an encrypted ",(0,r.kt)("inlineCode",{parentName:"p"},"challenge"),"."),(0,r.kt)("p",null,"The client then uses ",(0,r.kt)("inlineCode",{parentName:"p"},"salt")," and the user's password to generate ",(0,r.kt)("inlineCode",{parentName:"p"},"mainKey")," and from the ",(0,r.kt)("inlineCode",{parentName:"p"},"authenticationKeypair"),". The client then proceeds to sign ",(0,r.kt)("inlineCode",{parentName:"p"},"challenge")," as well as some extra data using a ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginResponse")," object with the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"username"),": the username this login request is for."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"challenge"),": the challenge sent from the server."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"host"),": the host of the server we are logging into."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"action"),": the string ",(0,r.kt)("inlineCode",{parentName:"li"},"login"),".")),(0,r.kt)("p",null,"The server then validates ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginResponse")," and if successful returns an ",(0,r.kt)("inlineCode",{parentName:"p"},"AuthenticationToken")," that can be used to interact with the API."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginResponse")," is uploaded to the ",(0,r.kt)("inlineCode",{parentName:"p"},"authentication/login/")," HTTP endpoint as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'LoginResponse {\n    username: str,\n    challenge: [u8], \n    host: str, // The server\'s hostname\n    action: str, // "login"\n}\n\nresponse = msgpack(loginResponse)\nsignature = sign(authenticationKeypair, response)\n\nLoginBody {\n    response: [u8],\n    signature: [u8],\n}\n')),(0,r.kt)("h2",{id:"password-change"},"Password Change"),(0,r.kt)("p",null,"A password change is very similar to ",(0,r.kt)("a",{parentName:"p",href:"#login"},"login")," as described above.\nIn order to change a user's login password, a client first asks the server for a ",(0,r.kt)("inlineCode",{parentName:"p"},"challenge"),", and then responds with a signed ",(0,r.kt)("inlineCode",{parentName:"p"},"response"),". The only differences are in the fields included in ",(0,r.kt)("inlineCode",{parentName:"p"},"response"),"."),(0,r.kt)("p",null,"The client first generates new ",(0,r.kt)("inlineCode",{parentName:"p"},"mainKey")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"authenticationKeypair")," similar to the ",(0,r.kt)("a",{parentName:"p",href:"#signup"},"signup")," section above."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"action"),": is set to the string ",(0,r.kt)("inlineCode",{parentName:"li"},"changePassword"),".")),(0,r.kt)("p",null,"And the following fields are added (similar to signup):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"loginPubkey"),": the ",(0,r.kt)("inlineCode",{parentName:"li"},"authenticationKeypair"),"'s public part."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"encryptedContent"),": the encrypted ",(0,r.kt)("inlineCode",{parentName:"li"},"identityKeypair")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"accountKey")," like in signup.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," is uploaded to the ",(0,r.kt)("inlineCode",{parentName:"p"},"authentication/change_password/")," HTTP endpoint as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'Response {\n    username: str,\n    challenge: [u8],\n    host: str, // The server\'s hostname\n    action: str, // "changePassword"\n\n    loginPubkey: [u8],\n    encryptedContent: [u8],\n}\n\npackedResponse = msgpack(response)\nsignature = sign(authenticationKeypair, packedResponse)\n\nBody {\n    response: [u8],\n    signature: [u8],\n}\n')))}h.isMDXComponent=!0}}]);